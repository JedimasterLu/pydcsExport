local socket = require("socket")

local ip = "2.0.0.1"
local port = 8080

local c = assert(socket.connect(ip, port))
c:settimeout(0)

local last_msg = nil
local index = 0

print("Connected!")
while true do
    index = index + 1
    sendMsg = 'modelTime,missionStartTime,name,type,country,coalition,coalitionId,lat,long,alt,x,y,z,heading,pitch,bank,unitName,groupName\n0,68700,Su-25,su-25,0,Allies,1,42.047538,44.148799,1987.990967,-282498.935261,1987.990967,823692.477809,4.705331,0.005242,-0.000000,Ru-CAS-3-2,Ru-CAS-3\n0,68700,F-16C_50,F-16C_50,2,Enemies,2,42.331498,42.128428,2436.409625,-270991.451732,2436.409625,652832.214683,1.787550,0.005242,-0.000000,CAS-2-2,CAS-2\n0,68700,F-16C_50,F-16C_50,2,Enemies,2,42.334151,42.123396,2436.409912,-270741.422879,2436.409912,652385.278420,1.787959,0.004566,-0.000000,- Colt 2,F-16C #001\n0,68700,Smerch,MLRS,0,Allies,1,42.171777,42.753906,105.238242,-282971.468754,105.238242,706477.749993,6.091199,0.002188,-0.007985,Unit #010,Akhaltsikhe SCUD Launch Site #001\n0,68700,Ural-4320-31,apa,0,Allies,1,42.171503,42.753883,105.137815,-283002.125004,105.137815,706479.374993,2.984513,-0.002462,0.007904,Unit #010,Akhaltsikhe SCUD Launch Site #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.155752,42.724619,88.047477,-285032.281248,88.047477,704260.437499,6.091199,-0.001657,-0.000433,Unit #011,Akhaltsikhe Armor Company #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.155280,42.730122,89.850996,-285032.312499,89.850996,704721.749994,0.401426,0.001670,-0.005708,Unit #071,Akhaltsikhe Armor Company #001\n0,68700,SAU Msta,sau msta,0,Allies,1,42.138145,42.748987,107.071900,-286757.718722,107.071900,706502.124980,6.091199,-0.031484,-0.013818,Unit #088,Akhaltsikhe Artillery #006\n0,68700,Ural-4320-31,apa,0,Allies,1,42.138078,42.747661,105.824284,-286777.749975,105.824284,706393.249988,3.141593,0.025042,0.012144,Unit #092,Akhaltsikhe Artillery #006\n0,68700,Ural-4320-31,apa,0,Allies,1,42.156226,42.734071,91.440347,-284889.593748,91.440347,705036.312494,0.959931,0.003610,-0.004856,Unit #104,Akhaltsikhe Convoy #001\n0,68700,BTR-80,brdm-2,0,Allies,1,42.154840,42.731439,90.513315,-285068.687502,90.513315,704836.312498,0.890118,0.003471,0.000377,Unit #108,Akhaltsikhe Convoy #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.153667,42.729563,89.852818,-285217.000002,89.852818,704696.187498,1.012291,0.002629,0.000766,Unit #112,Akhaltsikhe Convoy #001\n0,68700,Su-25,su-25,0,Allies,1,42.038996,43.781552,1997.990967,-287400.021454,1997.990967,793368.167608,4.742188,0.004543,-0.000000,Ru-CAS-2-1,Ru-CAS-2\n0,68700,Ural-4320-31,apa,0,Allies,1,42.163661,42.771130,102.711554,-283709.187491,102.711554,708006.625004,3.141593,0.008643,-0.004439,Akhaltsikhe Artillery #006-1-7,Akhaltsikhe Artillery #006-1\n0,68700,C-17A,c-17,2,Enemies,2,41.619161,41.474369,9445.788086,-355794.360492,9445.788086,606780.047701,0.008869,0.004447,0.000000,Pilot #006,C-17 #002\n0,68700,E-3A,e-3a,2,Enemies,2,42.169036,41.606859,9140.239258,-293568.823960,9140.239258,611653.792539,5.960606,0.004429,-0.000000,Aerial-1-1,AWACS\n0,68700,Smerch,MLRS,0,Allies,1,42.171928,42.751846,103.692544,-282974.250001,103.692544,706305.437492,6.091199,-0.000977,-0.007670,Unit #010,Akhaltsikhe SCUD Launch Site #001\n0,68700,Ural-4320-31,apa,0,Allies,1,42.171309,42.752265,103.988271,-283039.062501,103.988271,706347.999992,4.555309,-0.007702,0.000709,Unit #010,Akhaltsikhe SCUD Launch Site #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.156964,42.730570,89.750799,-284840.812499,89.750799,704737.312494,6.091199,-0.002326,-0.005234,Unit #011,Akhaltsikhe Armor Company #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.157100,42.725542,87.918323,-284873.593750,87.918323,704319.624998,5.235988,-0.001637,-0.000491,Unit #011,Akhaltsikhe Armor Company #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.153182,42.714575,84.575826,-285413.562509,84.575826,703462.374992,5.654867,0.002269,-0.011851,Unit #073,Akhaltsikhe Armor Company #001\n0,68700,SAU Msta,sau msta,0,Allies,1,42.138129,42.749554,107.889160,-286754.031222,107.889160,706549.187480,6.091199,-0.031484,-0.013818,Unit #089,Akhaltsikhe Artillery #006\n0,68700,Ural-4320-31,apa,0,Allies,1,42.138036,42.749006,107.466976,-286769.656222,107.466976,706505.062480,2.827433,0.032931,0.009879,Unit #093,Akhaltsikhe Artillery #006\n0,68700,Ural-4320-31,apa,0,Allies,1,42.155890,42.733457,91.243358,-284932.812502,91.243358,704989.874997,0.820305,0.003347,-0.000267,Unit #105,Akhaltsikhe Convoy #001\n0,68700,BTR-80,brdm-2,0,Allies,1,42.154509,42.730925,90.320677,-285110.437502,90.320677,704798.062498,0.925025,0.003295,0.000583,Unit #109,Akhaltsikhe Convoy #001\n0,68700,T-55,leopard-2,0,Allies,1,42.158618,42.726465,87.991394,-284696.000000,87.991394,704376.499999,1.523578,0.001514,0.000070,Unit #119,Akhaltsikhe Strafe Target #003\n0,68700,Su-25,su-25,0,Allies,1,42.035126,43.814379,1987.990967,-287482.802700,1987.990967,796144.916815,4.742188,0.005242,0.000000,Ru-CAS-2-2,Ru-CAS-2\n0,68700,Ural-4320-31,apa,0,Allies,1,42.163618,42.772475,103.062674,-283701.093739,103.062674,708118.437496,2.827433,0.011564,0.000679,Akhaltsikhe Artillery #006-1-8,Akhaltsikhe Artillery #006-1\n0,68700,Su-25,su-25,0,Allies,1,42.104702,43.401979,1997.990967,-284033.833498,1997.990967,761001.050966,4.637965,0.004543,-0.000000,Aerial-1-3,Ru-CAS-1\n0,68700,C-17A,c-17,2,Enemies,2,41.739991,41.899776,9445.788086,-338759.927694,9445.788086,640868.408043,0.045527,0.004447,-0.000000,Pilot #007,C-17 #003\n0,68700,F-16C_50,F-16C_50,2,Enemies,2,42.334185,42.121703,2436.409912,-270752.687500,2436.409912,652245.250000,8.077783,0.000000,0.000000,疾风鸟,Player\n0,68700,Ural-4320-31,apa,0,Allies,1,42.163611,42.773065,103.217312,-283696.312489,103.217312,708167.312496,2.967060,0.011357,0.002282,Akhaltsikhe Artillery #006-1-5,Akhaltsikhe Artillery #006-1\n0,68700,Smerch,MLRS,0,Allies,1,42.172034,42.753269,104.901701,-282948.968753,104.901701,706421.749991,6.091199,0.000839,-0.009583,Unit #010,Akhaltsikhe SCUD Launch Site #001\n0,68700,Ural-4320-31,apa,0,Allies,1,42.172050,42.752578,104.266039,-282953.718753,104.266039,706364.374989,2.949606,-0.000589,0.011181,Unit #010,Akhaltsikhe SCUD Launch Site #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.149188,42.711210,81.306282,-285889.562500,81.306282,703234.999997,5.340707,-0.002460,-0.002100,Unit #011,Akhaltsikhe Armor Company #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.149487,42.711456,81.371648,-285854.031250,81.371648,703251.562497,0.383972,0.001641,-0.002841,Unit #011,Akhaltsikhe Armor Company #001\n0,68700,SAU Msta,sau msta,0,Allies,1,42.138144,42.748444,106.342194,-286763.031222,106.342194,706457.187480,6.091199,-0.031484,-0.013818,Unit #086,Akhaltsikhe Artillery #006\n0,68700,Ural-4320-31,apa,0,Allies,1,42.138028,42.749595,108.288805,-286764.874972,108.288805,706553.937480,2.967060,0.031238,0.014365,Unit #090,Akhaltsikhe Artillery #006\n0,68700,BRDM-2,brdm-2,0,Allies,1,42.156750,42.735294,91.851456,-284819.625002,91.851456,705130.812497,0.907571,0.003487,0.000061,Unit #102,Akhaltsikhe Convoy #001\n0,68700,ZIL-131 KUNG,ZIL-131 KUNG,0,Allies,1,42.155581,42.732837,91.026596,-284973.062502,91.026596,704942.499997,0.890118,0.003592,-0.000015,Unit #106,Akhaltsikhe Convoy #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.154174,42.730358,90.121144,-285153.062502,90.121144,704755.437498,0.907571,0.003221,0.000547,Unit #110,Akhaltsikhe Convoy #001\n0,68700,SAU Msta,sau msta,0,Allies,1,42.163726,42.771913,102.788931,-283694.468739,102.788931,708070.499996,6.091199,-0.011396,-0.002083,Akhaltsikhe Artillery #006-1-1,Akhaltsikhe Artillery #006-1\n0,68700,Su-25,su-25,0,Allies,1,42.050601,44.115832,1997.990967,-282518.528984,1997.990967,820914.541101,4.705331,0.004543,-0.000000,Ru-CAS-3-1,Ru-CAS-3\n0,68700,Ural-4320-31,apa,0,Allies,1,42.163478,42.771771,103.065269,-283723.406239,103.065269,708061.999996,2.949606,0.011394,0.002083,Akhaltsikhe Artillery #006-1-6,Akhaltsikhe Artillery #006-1\n0,68700,F-16C_50,F-16C_50,2,Enemies,2,42.330818,42.128883,2436.409912,-271062.952080,2436.409912,652877.903855,1.787550,0.004567,0.000000,CAS-2-1,CAS-2\n0,68700,C-17A,c-17,2,Enemies,2,42.673226,42.144086,9445.788086,-232866.473351,9445.788086,649992.540065,3.081307,0.004447,-0.000000,Pilot #008,C-17 #004\n0,68700,SAU Msta,sau msta,0,Allies,1,42.163712,42.773023,103.080015,-283685.468739,103.080015,708162.499996,6.091199,-0.011396,-0.002083,Akhaltsikhe Artillery #006-1-4,Akhaltsikhe Artillery #006-1\n0,68700,SAU Msta,sau msta,0,Allies,1,42.163727,42.772456,102.921220,-283689.156239,102.921220,708115.437496,6.091199,-0.011394,-0.002083,Akhaltsikhe Artillery #006-1-3,Akhaltsikhe Artillery #006-1\n0,68700,Smerch,MLRS,0,Allies,1,42.171440,42.752922,104.485547,-283018.281253,104.485547,706400.687489,6.091199,0.000587,-0.011181,Unit #010,Akhaltsikhe SCUD Launch Site #001\n0,68700,Ural-4320-31,apa,0,Allies,1,42.171229,42.752274,103.997798,-283047.906251,103.997798,706349.812492,4.468043,-0.007607,0.001377,Unit #010,Akhaltsikhe SCUD Launch Site #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.156763,42.725490,87.932502,-284911.500000,87.932502,704319.624998,0.418879,0.000359,-0.001706,Unit #011,Akhaltsikhe Armor Company #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.147262,42.710311,81.016903,-286112.187501,81.016903,703185.249997,6.091199,0.000194,-0.002580,Unit #070,Akhaltsikhe Armor Company #001\n0,68700,SAU Msta,sau msta,0,Allies,1,42.138191,42.747639,105.474857,-286765.406225,105.474857,706389.937488,6.091199,-0.026899,-0.007143,Unit #087,Akhaltsikhe Artillery #006\n0,68700,Ural-4320-31,apa,0,Allies,1,42.137895,42.748303,106.994025,-286791.968722,106.994025,706448.687480,2.949606,0.031483,0.013818,Unit #091,Akhaltsikhe Artillery #006\n0,68700,BRDM-2,brdm-2,0,Allies,1,42.156582,42.734886,91.715503,-284842.218751,91.715503,705099.249996,0.541052,0.002744,-0.002993,Unit #103,Akhaltsikhe Convoy #001\n0,68700,ZIL-131 KUNG,ZIL-131 KUNG,0,Allies,1,42.155258,42.732128,90.776182,-285015.687502,90.776182,704887.999997,0.959931,0.003605,0.000345,Unit #107,Akhaltsikhe Convoy #001\n0,68700,T-72B,leopard-2,0,Allies,1,42.153213,42.728892,89.686298,-285273.843751,89.686298,704646.437499,0.820305,0.001331,0.000176,Unit #111,Akhaltsikhe Convoy #001\n0,68700,Su-25,su-25,0,Allies,1,42.103506,43.435234,1987.990967,-283827.271103,1987.990967,763771.362680,4.637965,0.005242,-0.000000,Ru-CAS-1-1,Ru-CAS-1\n0,68700,SAU Msta,sau msta,0,Allies,1,42.163774,42.771108,102.619573,-283696.843741,102.619573,708003.312504,6.091199,-0.007637,0.006007,Akhaltsikhe Artillery #006-1-2,Akhaltsikhe Artillery #006-1\nendOfMsg\n'
    c:send(sendMsg)
    local s, status, partial = c:receive()
    socket.sleep(1)
    print(s)
    if status == "closed" then
        c:send('quit\n')
        break
    end
    if index > 3 then
        c:send('quit\n')
        break
    end
end
c:close()
print("Client shut down!")